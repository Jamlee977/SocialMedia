<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Posts</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    </head>
    <body>
        <nav>
            <ul class="nav justify-content-center">
                <li class="nav-item">
                    <h1 class="text-center">Posts</h1>
                </li>
            </ul>
        </nav>

        <div class="container justify-content-center">
            <button class="btn btn-dark" type="button" data-bs-toggle="modal" data-bs-target="#postModal">Add Post</button>
        </div>
        
        <div class="modal fade" id="postModal" tabindex="-1" aria-labelledby="postModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="postModalLabel">Add Post</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="postContent">Post Content</label>
                            <textarea name="post" class="form-control" id="postContent"></textarea>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" id="add_post_button" disabled>Add</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <br/>
        <br/>
        <div id="displayed_posts" class="container">
        </div>
        
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
        <script>
            const addPostButton = document.getElementById("add_post_button");
            const displayedPosts = document.getElementById("displayed_posts");
            const postConetentInput = document.getElementById("postContent");

            postConetentInput.addEventListener("input", () => {
                if (postConetentInput.value.length > 0) {
                    addPostButton.disabled = false;
                } else {
                    addPostButton.disabled = true;
                }
            });

            addPostButton.addEventListener("click", async () => {
                const response = await fetch("/api/add-post", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        content: postConetentInput.value
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    const modal = document.getElementById("postModal");
                    const modalInstance = bootstrap.Modal.getInstance(modal);
                    document.getElementById("postContent").value = "";
                    modalInstance.hide();
                    addPostButton.disabled = true;
                    return;
                }

                const post = document.createElement("div");
                post.classList.add("card");
                post.classList.add("mb-3");
                post.classList.add("w-50");
                post.classList.add("mx-auto");

                const postBody = document.createElement("div");
                postBody.classList.add("card-body");

                const postContent = document.createElement("p");
                postContent.classList.add("card-text");
                postContent.innerText = data.content;

                postBody.appendChild(postContent);
                post.appendChild(postBody);
                displayedPosts.appendChild(post);

                const modal = document.getElementById("postModal");
                const modalInstance = bootstrap.Modal.getInstance(modal);
                document.getElementById("postContent").value = "";
                modalInstance.hide();
                addPostButton.disabled = true;
            });
        </script>
    </body>
</html>

